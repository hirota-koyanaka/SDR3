# 里山ドッグラン管理システム 実装計画書

## 1. プロジェクト概要

### 1.1 目的
愛媛県今治市の里山ドッグラン施設向けWebアプリケーションを3ヶ月で開発する。

### 1.2 開発方針
- **MVP（最小限の製品）アプローチ**：コア機能から段階的に実装
- **アジャイル開発**：2週間スプリントで進捗管理
- **モバイルファースト**：スマートフォンでの利用を優先した設計

## 2. 技術スタック詳細

### 2.1 技術構成

#### バックエンド
- **フレームワーク**: FastAPI (Python)
- **ORM**: SQLAlchemy
- **認証**: Supabase Auth + JWT
- **データベース**: 
  - 開発環境: Supabase Local (PostgreSQL)
  - 本番環境: Supabase (PostgreSQL)

#### フロントエンド
- **フレームワーク**: Next.js 14 (TypeScript)
- **UIライブラリ**: Radix UI
- **スタイリング**: Tailwind CSS  
- **状態管理**: React Context API
- **通信**: Supabase Client + Axios

### 2.2 デプロイメント環境
- **フロントエンド**: Vercel
- **バックエンド**: Vercel Serverless Functions
- **データベース**: Supabase (PostgreSQL)
- **ストレージ**: Supabase Storage（画像・ファイル）
- **リアルタイム**: Supabase Realtime（通知・更新）

### 2.3 バックエンド構成
```
backend/
├── app/
│   ├── __init__.py
│   ├── main.py                 # FastAPIアプリケーションエントリーポイント
│   ├── api/
│   │   ├── __init__.py
│   │   ├── v1/
│   │   │   ├── __init__.py
│   │   │   ├── auth.py         # 認証エンドポイント
│   │   │   ├── users.py        # ユーザー管理
│   │   │   ├── applications.py # 申請管理
│   │   │   ├── dogs.py         # 犬情報管理
│   │   │   ├── posts.py        # SNS投稿
│   │   │   ├── events.py       # イベント管理
│   │   │   ├── admin.py        # 管理者機能
│   │   │   └── entries.py      # 入退場管理
│   ├── core/
│   │   ├── __init__.py
│   │   ├── config.py           # 設定管理
│   │   ├── security.py         # セキュリティ設定
│   │   └── database.py         # データベース接続
│   ├── models/
│   │   ├── __init__.py
│   │   ├── user.py
│   │   ├── application.py
│   │   ├── dog.py
│   │   ├── post.py
│   │   ├── event.py
│   │   └── entry_log.py
│   ├── schemas/
│   │   ├── __init__.py
│   │   └── [各モデル対応のスキーマ]
│   ├── services/
│   │   ├── __init__.py
│   │   ├── auth_service.py
│   │   ├── email_service.py
│   │   ├── file_service.py
│   │   └── qr_service.py
│   └── utils/
│       ├── __init__.py
│       └── validators.py
├── alembic/                     # データベースマイグレーション
├── tests/
├── requirements.txt
├── .env.example
└── Dockerfile
```

### 2.4 フロントエンド構成
```
frontend/
├── src/
│   ├── app/                    # Next.js 14 App Router
│   │   ├── layout.tsx
│   │   ├── page.tsx
│   │   ├── (auth)/
│   │   │   ├── login/
│   │   │   ├── register/
│   │   │   └── application/
│   │   ├── (dashboard)/
│   │   │   ├── admin/
│   │   │   └── user/
│   │   ├── events/
│   │   ├── feed/
│   │   └── api/
│   ├── components/
│   │   ├── ui/                 # Radix UI コンポーネント
│   │   ├── forms/
│   │   ├── layouts/
│   │   └── features/
│   ├── lib/
│   │   ├── api/                # API クライアント
│   │   ├── utils/
│   │   └── constants/
│   ├── hooks/
│   ├── contexts/
│   └── types/
├── public/
├── package.json
├── tsconfig.json
├── tailwind.config.js
├── next.config.js
└── Dockerfile
```

## 3. 開発フェーズ詳細

### フェーズ0: 環境構築（3日間）

#### Day 1: 開発環境セットアップ
- [ ] リポジトリ作成とGit設定
- [ ] バックエンドプロジェクト初期化
  - FastAPIプロジェクト作成
  - 仮想環境設定
  - 基本的な依存パッケージインストール
- [ ] フロントエンドプロジェクト初期化
  - Next.js 14プロジェクト作成
  - TypeScript設定
  - Tailwind CSS設定
  - Radix UI設定

#### Day 2: データベース設計
- [ ] SQLAlchemyモデル定義
- [ ] Alembicマイグレーション設定
- [ ] 初期データベーススキーマ作成
- [ ] Supabase Localセットアップ
- [ ] Supabaseプロジェクト作成（開発用）

#### Day 3: 基本設定とCI/CD
- [ ] 環境変数管理設定
- [ ] CORS設定
- [ ] ログ設定
- [ ] Vercel設定（プロジェクト連携）
- [ ] Supabase環境変数設定
- [ ] GitHub Actions基本設定

### フェーズ1: コア機能実装（4週間）

#### Week 1: 認証システム
**バックエンド**
- [ ] JWTトークン実装
- [ ] ユーザーモデル作成
- [ ] 認証エンドポイント実装
  - POST /api/v1/auth/register
  - POST /api/v1/auth/login
  - POST /api/v1/auth/refresh
  - POST /api/v1/auth/logout
- [ ] パスワードハッシュ化（bcrypt）
- [ ] 認証ミドルウェア作成

**フロントエンド**
- [ ] ログインページUI作成
- [ ] 認証Context実装
- [ ] APIクライアント設定（Axios）
- [ ] 認証ガード実装
- [ ] トークン管理（localStorage/Cookie）

#### Week 2: 申請管理システム
**バックエンド**
- [ ] 申請モデル作成
- [ ] ファイルアップロード機能（ワクチン証明書）
- [ ] 申請エンドポイント実装
  - POST /api/v1/applications
  - GET /api/v1/applications/{id}
  - GET /api/v1/applications/status
- [ ] 申請ステータス管理ロジック

**フロントエンド**
- [ ] 申請フォームUI（多段階フォーム）
- [ ] ファイルアップロードコンポーネント
- [ ] 申請状況確認画面
- [ ] フォームバリデーション

#### Week 3: 管理者基本機能
**バックエンド**
- [ ] 管理者認証・権限管理
- [ ] 管理者用エンドポイント
  - GET /api/v1/admin/applications
  - PUT /api/v1/admin/applications/{id}/approve
  - PUT /api/v1/admin/applications/{id}/reject
  - GET /api/v1/admin/users
  - GET /api/v1/admin/dashboard/stats
- [ ] 管理者操作ログ記録

**フロントエンド**
- [ ] 管理者ダッシュボード
- [ ] 申請一覧・詳細画面
- [ ] 承認/却下機能UI
- [ ] 統計情報表示コンポーネント

#### Week 4: ユーザー管理と犬情報
**バックエンド**
- [ ] 犬情報モデル作成
- [ ] ユーザープロフィール管理
- [ ] 犬情報CRUD操作
  - POST /api/v1/dogs
  - GET /api/v1/dogs
  - PUT /api/v1/dogs/{id}
  - DELETE /api/v1/dogs/{id}
- [ ] ワクチン接種履歴管理

**フロントエンド**
- [ ] マイページ実装
- [ ] プロフィール編集画面
- [ ] 犬情報管理画面
- [ ] ワクチン履歴表示

### フェーズ2: 拡張機能実装（4週間）

#### Week 5: SNS機能（フィード）
**バックエンド**
- [ ] 投稿モデル作成（画像、ハッシュタグ対応）
- [ ] 投稿エンドポイント
  - POST /api/v1/posts
  - GET /api/v1/posts
  - POST /api/v1/posts/{id}/like
  - POST /api/v1/posts/{id}/comment
- [ ] 画像アップロード処理
- [ ] コンテンツモデレーション機能

**フロントエンド**
- [ ] フィード画面
- [ ] 投稿作成フォーム
- [ ] 画像アップロード機能
- [ ] いいね・コメント機能
- [ ] 無限スクロール実装

#### Week 6: イベント管理
**バックエンド**
- [ ] イベントモデル作成
- [ ] イベントCRUD操作
- [ ] 参加登録機能
- [ ] 定員管理ロジック
- [ ] カレンダーデータAPI

**フロントエンド**
- [ ] イベントカレンダー表示
- [ ] イベント詳細画面
- [ ] 参加申込フォーム
- [ ] 管理者用イベント作成画面

#### Week 7: 入退場管理とQRコード
**バックエンド**
- [ ] QRコード生成機能
- [ ] 入退場記録API
- [ ] 現在の利用者リスト取得
- [ ] 入場制限チェック

**フロントエンド**
- [ ] QRコード表示画面
- [ ] 入退場管理画面（管理者用）
- [ ] 現在の利用者表示
- [ ] QRコードスキャナー（管理者用）

#### Week 8: お知らせ・通知機能
**バックエンド**
- [ ] お知らせモデル作成
- [ ] 通知システム実装
- [ ] 既読管理機能
- [ ] 優先度別表示ロジック

**フロントエンド**
- [ ] お知らせ一覧画面
- [ ] 通知バッジ表示
- [ ] お知らせ詳細画面
- [ ] 管理者用お知らせ作成画面

### フェーズ3: 品質向上とデプロイ（4週間）

#### Week 9: テスト実装
- [ ] バックエンドユニットテスト
- [ ] バックエンド統合テスト
- [ ] フロントエンドコンポーネントテスト
- [ ] E2Eテスト（主要フロー）
- [ ] パフォーマンステスト

#### Week 10: UI/UX改善
- [ ] レスポンシブデザイン調整
- [ ] アクセシビリティ改善
- [ ] ローディング状態の実装
- [ ] エラーハンドリング改善
- [ ] FC今治ブランドガイドライン適用

#### Week 11: セキュリティとパフォーマンス
- [ ] セキュリティ監査
- [ ] SQLインジェクション対策確認
- [ ] XSS対策確認
- [ ] API レート制限実装
- [ ] キャッシュ戦略実装
- [ ] 画像最適化

#### Week 12: デプロイと運用準備
- [ ] Vercel本番環境設定
- [ ] Supabase本番プロジェクト設定
- [ ] 環境変数の本番設定
- [ ] CI/CDパイプライン完成（Vercel自動デプロイ）
- [ ] Supabaseバックアップ設定
- [ ] 監視設定（Vercel Analytics）
- [ ] ドキュメント整備
- [ ] 運用マニュアル作成

## 4. 開発優先順位

### 必須機能（MVP）
1. ユーザー認証（ログイン/ログアウト）
2. 利用申請・承認システム
3. 基本的な管理者機能
4. 犬情報管理
5. お知らせ表示

### 優先度高
1. SNS機能（投稿・いいね・コメント）
2. イベント管理
3. QRコード入退場
4. 営業時間表示

### 優先度中
1. 詳細な統計情報
2. 高度な検索機能
3. プッシュ通知

### 将来的な拡張
1. 予約システム
2. 決済機能
3. AI機能
4. IoT連携

## 5. リスク管理と対策

### 技術的リスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| Vercel/Supabase環境の学習コスト | 中 | 公式ドキュメントとサンプルプロジェクトの活用 |
| ファイルアップロード処理 | 中 | ファイルサイズ制限とウイルススキャン実装 |
| リアルタイム更新 | 中 | WebSocketまたはポーリング実装 |

### スケジュールリスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| 要件の追加・変更 | 高 | 週次でステークホルダーとレビュー |
| 外部API連携遅延 | 中 | モックAPIで開発を進める |

## 6. 成功指標

### 技術指標
- コードカバレッジ: 70%以上
- Lighthouseスコア: 80以上
- API応答時間: 平均500ms以下
- ページロード時間: 2秒以内

### ビジネス指標
- 申請処理時間: 50%削減
- ユーザー満足度: 4.0/5.0以上
- システム稼働率: 99.5%以上

## 7. 開発規約

### コーディング規約
**Python（バックエンド）**
- PEP 8準拠
- Type hintsの使用
- Docstringの記載

**TypeScript（フロントエンド）**
- ESLint + Prettier設定
- strictモード有効
- 関数コンポーネント使用

### Git運用
- GitFlow採用
- feature/*, develop, main ブランチ
- プルリクエスト必須
- コミットメッセージ規約（feat:, fix:, docs:等）

### レビュー基準
- 機能要件の充足
- コード品質（可読性、保守性）
- テストの実装
- ドキュメントの更新

## 8. 必要なリソース

### 開発環境
- Node.js 18+
- Python 3.11+
- Docker Desktop
- VSCode または同等のIDE

### 外部サービス
- Vercel アカウント
- Supabase アカウント
- SendGrid（メール送信）※Supabase Edgeで代替可能

### 開発ツール
- Postman（API テスト）
- Figma（デザイン）
- GitHub（ソースコード管理）
- Notion/Jira（プロジェクト管理）

## 9. 次のアクション

### 即座に実施
1. Git リポジトリの作成
2. 開発環境のセットアップ
3. プロジェクト構造の初期化

### 1週目の目標
1. 認証システムの基本実装
2. データベーススキーマの確定
3. CI/CDパイプラインの基礎構築

### マイルストーン
- **2週目終了時**: ログインと申請機能の動作確認
- **4週目終了時**: 管理者が申請を承認できる状態
- **8週目終了時**: 全主要機能の実装完了
- **12週目終了時**: 本番環境でのリリース

---

**更新履歴**
- 2025-01-19: 初版作成